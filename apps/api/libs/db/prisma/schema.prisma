generator client {
  provider     = "prisma-client"
  output       = "../generated/client"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model SystemAdmin {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  lastLogin DateTime?
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  password     String
  fullName     String
  image        String?
  role         UserRole      @default(CUSTOMER)
  phone        String        @unique
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  otpCode      String?
  otpExpires   DateTime?
  username     String        @unique
  reservations Reservation[]
  restaurants  Restaurant[]
}

model Restaurant {
  id        Int        @id @default(autoincrement())
  name      String     @unique
  logoUrl   String?
  ownerId   Int
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  branches  Branch[]
  menuItems MenuItem[]
  user      User       @relation(fields: [ownerId], references: [id])
}

model Branch {
  id               Int              @id @default(autoincrement())
  name             String
  address          String
  restaurantId     Int
  haveTables       Boolean          @default(false)
  haveReservations Boolean          @default(false)
  haveWarehouses   Boolean          @default(false)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  restaurant       Restaurant       @relation(fields: [restaurantId], references: [id])
  branchMenu       BranchMenuItem[]
  employees        Employee[]
  expenses         Expense[]
  orders           Order[]
  reservations     Reservation[]
  shifts           Shift[]
  tables           Table[]
  warehouses       Warehouse[]
}

model MenuItem {
  id           Int              @id @default(autoincrement())
  name         String
  description  String?
  basePrice    Decimal          @db.Decimal(10, 2)
  restaurantId Int
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  branchStatus BranchMenuItem[]
  restaurant   Restaurant       @relation(fields: [restaurantId], references: [id])
  orderItems   OrderItem[]
}

model BranchMenuItem {
  id          Int      @id @default(autoincrement())
  branchId    Int
  menuItemId  Int
  isAvailable Boolean  @default(true)
  branch      Branch   @relation(fields: [branchId], references: [id])
  menuItem    MenuItem @relation(fields: [menuItemId], references: [id])

  @@unique([branchId, menuItemId])
}

model Employee {
  id        Int       @id @default(autoincrement())
  fullName  String
  username  String    @unique
  password  String
  role      StaffRole @default(WAITER)
  salary    Decimal   @db.Decimal(10, 2)
  branchId  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  branch    Branch    @relation(fields: [branchId], references: [id])
  shifts    Shift[]
}

model Shift {
  id         Int       @id @default(autoincrement())
  employeeId Int
  branchId   Int
  startTime  DateTime  @default(now())
  endTime    DateTime?
  status     String    @default("ACTIVE")
  branch     Branch    @relation(fields: [branchId], references: [id])
  employee   Employee  @relation(fields: [employeeId], references: [id])
}

model Order {
  id          Int         @id @default(autoincrement())
  totalAmount Decimal     @db.Decimal(10, 2)
  branchId    Int
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  branch      Branch      @relation(fields: [branchId], references: [id])
  items       OrderItem[]
}

model OrderItem {
  id         Int      @id @default(autoincrement())
  orderId    Int
  menuItemId Int
  quantity   Int
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])
  order      Order    @relation(fields: [orderId], references: [id])
}

model Expense {
  id          Int         @id @default(autoincrement())
  amount      Decimal     @db.Decimal(10, 2)
  category    ExpenseType
  description String?
  branchId    Int
  createdAt   DateTime    @default(now())
  branch      Branch      @relation(fields: [branchId], references: [id])
}

model Table {
  id           Int           @id @default(autoincrement())
  tableNumber  String
  capacity     Int
  branchId     Int
  reservations Reservation[]
  branch       Branch        @relation(fields: [branchId], references: [id])

  @@unique([tableNumber, branchId])
}

model Warehouse {
  id       Int             @id @default(autoincrement())
  name     String
  branchId Int
  items    InventoryItem[]
  branch   Branch          @relation(fields: [branchId], references: [id])
}

model InventoryItem {
  id          Int       @id @default(autoincrement())
  name        String
  quantity    Float
  unit        String
  warehouseId Int
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
}

model Reservation {
  id              Int      @id @default(autoincrement())
  reservationTime DateTime
  depositAmount   Decimal  @db.Decimal(10, 2)
  isPaid          Boolean  @default(false)
  tableId         Int
  branchId        Int
  createdAt       DateTime @default(now())
  userId          Int
  branch          Branch   @relation(fields: [branchId], references: [id])
  table           Table    @relation(fields: [tableId], references: [id])
  user            User     @relation(fields: [userId], references: [id])
}

model TokenBlacklist {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  createdAt DateTime @default(now())
}

enum UserRole {
  CUSTOMER
  BUSINESS_OWNER
}

enum StaffRole {
  ADMIN
  CASHIER
  WAITER
}

enum ExpenseType {
  INGREDIENTS
  SALARY
  RENT
  UTILITIES
  LOSSES
  MARKETING
}
